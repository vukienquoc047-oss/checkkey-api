<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Danh s√°ch t·∫•t c·∫£ key</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>
  <div class="page-shell">
    <div class="card">
      <div class="flex-between">
        <div class="card-header" style="text-align:left;margin-bottom:16px;">
          <div class="badge">üîë T·∫•t c·∫£ key</div>
          <h1 class="card-title" style="font-size:1.4rem;">Danh s√°ch License Key</h1>
          <p class="card-subtitle">
            Hi·ªÉn th·ªã to√†n b·ªô key, tr·∫°ng th√°i, ghi ch√∫, HWID v√† l·ªãch s·ª≠.
          </p>
        </div>
        <button class="btn btn-ghost btn-sm" onclick="goBack()">‚Üê V·ªÅ menu</button>
      </div>

      <div class="table-wrap mt-3">
        <table>
          <thead>
            <tr>
              <th>Key</th>
              <th>Th·ªùi h·∫°n</th>
              <th>Ghi ch√∫</th>
              <th>HWID</th>
              <th>Tr·∫°ng th√°i</th>
              <th>L·ªãch s·ª≠</th>
              <th>Copy</th>
            </tr>
          </thead>
          <tbody id="keysBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    function goBack() {
      window.location.href = "admin.html";
    }

    async function loadAllKeys() {
      try {
        const res = await fetch("/api/keys");
        const data = await res.json();

        if (!data.success) {
          Swal.fire("L·ªói!", "Kh√¥ng t·∫£i ƒë∆∞·ª£c danh s√°ch key!", "error");
          return;
        }

        const tbody = document.getElementById("keysBody");
        tbody.innerHTML = "";

        const db = data.data;

        Object.keys(db).forEach(key => {
          const item = db[key];
          const tr = document.createElement("tr");

          tr.innerHTML = `
            <td><b>${key}</b></td>
            <td>${item.duration}</td>
            <td>${item.note || ""}</td>
            <td>${item.hwid || "Ch∆∞a bind"}</td>
            <td>
              <span class="status-pill ${item.locked ? "status-locked" : "status-ok"}">
                ${item.locked ? "locked" : "ok"}
              </span>
            </td>
            <td>${item.history ? item.history.length : 0} l·∫ßn</td>
            <td>
              <button class="btn btn-sm btn-primary" onclick="copyKey('${key}')">üìã</button>
            </td>
          `;

          tbody.appendChild(tr);
        });

      } catch (err) {
        Swal.fire("L·ªói k·∫øt n·ªëi!", "Kh√¥ng k·∫øt n·ªëi t·ªõi server!", "error");
      }
    }

    function copyKey(key) {
      navigator.clipboard.writeText(key);
      Swal.fire("ƒê√£ copy key!", key, "success");
    }

    loadAllKeys();
  </script>
</body>
</html>
